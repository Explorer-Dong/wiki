---
title: Hexo
icon: simple/hexo
---

æˆ‘æ¯”è¾ƒå–œæ¬¢æŒ‰ç…§æ ‘çš„ç»“æ„ä½“ç³»åŒ–åœ°æ•´ç†ç”µå­ç¬”è®°ï¼Œæˆ‘ä¸€èˆ¬å°†å…¶ç§°ä¸ºçŸ¥è¯†åº“ (Wiki)ï¼Œä¸ªäººè‰²å½©å¼ºä¸€ç‚¹çš„è¯ä¹Ÿå¯ä»¥å«åšæŠ€æœ¯åšå®¢ã€‚è®©æˆ‘äº§ç”Ÿã€Œå°†çŸ¥è¯†åº“æ­å»ºä¸ºåœ¨çº¿ç½‘ç«™ã€è¿™ä¸ªæƒ³æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

- åˆ†äº«ç¬”è®°æ—¶ï¼Œå¦‚æœç›´æ¥å‘æ–‡ä»¶ä¸èƒ½å®æ—¶æ›´æ–°ï¼Œä¾æ‰˜åœ¨çº¿ç¬”è®°è½¯ä»¶ä¹Ÿä¸å¤Ÿä¼˜é›…ï¼Œæ¯”å¦‚é£ä¹¦çš„é“¾æ¥ä¸èƒ½è‡ªå®šä¹‰ã€GitHub æœ‰ç½‘ç»œé™åˆ¶ç­‰ï¼›
- æ•´ç†ç¬”è®°æ—¶ï¼Œä»¥ç½‘ç«™çš„å½¢å¼å‘ˆç°å†…å®¹åœ¨æ¶æ„ä¸Šä¼šæ›´åŠ æ¸…æ™°ï¼Œæ›´æœ‰åŠ©äºæˆ‘å¯¹ç¬”è®°è¿›è¡Œä¿®æ”¹ã€æ¶¦è‰²å’Œé“¾æ¥ï¼›
- é˜…è¯»ç¬”è®°æ—¶ï¼Œä»¥ç½‘ç«™çš„å½¢å¼å‘ˆç°å†…å®¹åœ¨å¤šç«¯é˜…è¯»æ—¶ä¼šéå¸¸æ–¹ä¾¿ï¼Œé¿å…äº†çº¯ Markdown çš„æ ¼å¼æ¸²æŸ“é—®é¢˜ã€‚

æ‰€ä»¥ç´¢æ€§ç›´æ¥å°†ç¬”è®°æ‰“åŒ…æˆç½‘ç«™éƒ¨ç½²åˆ°å¤§é™†çš„æœåŠ¡å™¨ä¸Šã€‚ç°åœ¨ã€Œä»¥å†…å®¹ä¸ºä¸»ã€çš„ä¸»æµå»ºç«™æ¨¡å¼åŠå…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š

1. æœ‰åç«¯ï¼š[WordPress](https://cn.wordpress.org/) ç­‰ã€‚ç”¨åœ¨çŸ¥è¯†åº“ä¸Šæ˜¾å¾—æœ‰äº›å¤§æå°ç”¨ï¼Œä¹Ÿä¸å¤ªé€‚åˆå¤šäººç¼–è¾‘è¿›è¡Œå¼€æºï¼›
2. æ— åç«¯ï¼š[Hexo](https://hexo.io/zh-cn/)ã€[Mkdocs](https://www.mkdocs.org/)ã€[VuePress](https://v2.vuepress.vuejs.org/zh/)ã€[Gatsby](https://www.gatsbyjs.com/docs) ç­‰ã€‚å¾ˆé€‚åˆæ›´æ–°ä¸æ€ä¹ˆé¢‘ç¹çš„ä¸­å°å‹çŸ¥è¯†åº“åœºæ™¯ï¼ŒåŸç†å°±æ˜¯åˆ©ç”¨ [é™æ€ç«™ç‚¹ç”Ÿæˆå™¨](https://developer.mozilla.org/zh-CN/docs/Glossary/SSG) (Static Site Generator, SSG)ï¼Œå°†å†™å¥½çš„ Markdown æ–‡ä»¶è½¬æ¢ä¸º [HTML](../front-end/html.md)ã€[CSS](../front-end/css.md) å’Œ [JavaScript](../front-end/javascript/index.md) æ–‡ä»¶ä¾›æµè§ˆå™¨æ¸²æŸ“ã€‚ä½œè€…åªéœ€å…³æ³¨æ–‡ç« çš„å†…å®¹æœ¬èº«ï¼Œå³å¯åœ¨æçŸ­çš„æ—¶é—´å†…æ„å»ºä¸€ä¸ªå¯ä¾›å¤–ç½‘è®¿é—®çš„ç½‘ç«™ã€‚

æœ¬æ–‡å°±ä»¥ Hexo ä¸ºä¾‹è®²è§£å¦‚ä½•ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªè‡ªå·±çš„çŸ¥è¯†åº“ç½‘ç«™ã€‚æŒæ¡äº†è¯¥æ–¹æ³•ï¼Œå…¶ä½™çš„ SSG é€»è¾‘éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œä¹Ÿå°±ä¸€é€šç™¾é€šäº†ã€‚

!!! tip
    åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦åœ¨æœ¬åœ°å®‰è£…å¥½ [Node.js](https://nodejs.org/zh-cn) å’Œ [Git](https://git-scm.com/)ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª [GitHub](https://github.com) è´¦å·ã€‚

## æœ¬åœ°è°ƒè¯•

æœ¬åœ°è°ƒè¯•æ˜¯ä¸ºäº†é¢„è§ˆç½‘ç«™éƒ¨ç½²åçš„æ ·å¼ï¼Œè¿™é‡Œå‡è®¾ä½ å·²ç»æœ‰äº†è‡ªå·±çš„ Markdown ç¬”è®°ã€‚

1ï¼‰å…¨å±€å®‰è£… Hexo çš„å‘½ä»¤è¡Œå·¥å…·ï¼š

```bash
npm install -g hexo-cli
```

2ï¼‰åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ååˆå§‹åŒ–é¡¹ç›®ï¼š

```bash
mkdir web
cd web
hexo init
```

3ï¼‰å®‰è£…æ‰€æœ‰çš„åº“ä¾èµ–ï¼š

```bash
npm install
```

4ï¼‰å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼ˆæ­¤æ—¶ä¼šåœ¨ temp æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆç½‘ç«™ï¼‰ï¼š

```bash
hexo server  # å¯ç®€å†™ä¸º hexo s
```

Hexo æœåŠ¡é»˜è®¤å ç”¨ 4000 ç«¯å£ã€‚ç°åœ¨ç”¨æµè§ˆå™¨è®¿é—® `http://localhost:4000`ï¼Œåº”å½“èƒ½çœ‹åˆ° Hexo çš„é»˜è®¤æ ·å¼ç½‘ç«™äº†ã€‚

## äº‘ç«¯éƒ¨ç½²

æœ¬åœ°è°ƒè¯•æ²¡é—®é¢˜åï¼Œå°±å¯ä»¥æ‰“åŒ…ç½‘ç«™å¹¶éƒ¨ç½²åˆ°æœåŠ¡å™¨äº†ã€‚æ‰€è°“æ‰“åŒ…ï¼Œå°±æ˜¯å°† Markdown ç¬”è®°è½¬åŒ–ä¸º HTML ç½‘é¡µï¼›æ‰€è°“éƒ¨ç½²ï¼Œå°±æ˜¯å°†ç½‘é¡µæ”¾åˆ°æœåŠ¡å™¨ã€‚ä¹‹åç”¨æˆ·å°±å¯ä»¥é€šè¿‡ IP æˆ–åŸŸåçš„æ–¹å¼è®¿é—®ä½ çš„ç¬”è®°äº†ã€‚

è¿™é‡Œä»‹ç»ä»¥ä¸‹å››ç§æ–¹æ³•ï¼ˆé€‰æ‹©å…¶ä¸­çš„ä»»æ„ä¸€ç§æ–¹æ³•éƒ¨ç½²ä½ çš„ç½‘ç«™å³å¯ï¼‰ï¼š

```mermaid
graph LR
  A(éƒ¨ç½² Hexo)
  S1(åŸºäº GitHub Pages)
  S2(åŸºäºç§æœ‰äº‘æœåŠ¡å™¨)
  m1(åŸºäº hexo-deploy-git æ’ä»¶)
  m2(åŸºäº GitHub Actions å·¥ä½œæµ)
  m3(åŸºäº Git Hooks)
  m4(åŸºäºæœ€æœ´ç´ çš„æ–¹æ³•)
  A --> S1
  A --> S2
  S1 --> m1
  S1 --> m2
  S2 --> m3
  S2 --> m4
```

### åŸºäº hexo-deploy-git æ’ä»¶

å…ˆä»‹ç»ä¸€ä¸‹ GitHub Pagesã€‚GitHub Pages æ˜¯ GitHub å®˜æ–¹æä¾›çš„é™æ€ç«™ç‚¹æ‰˜ç®¡å¹³å°ï¼Œå…¶å¯ä»¥ä»¥ã€Œé¡¹ç›®ã€ä¸ªäººå’Œç»„ç»‡ã€ä¸‰ç§å½¢å¼è¿›è¡Œæ‰˜ç®¡ï¼Œä¾‹å¦‚ï¼š

- é¡¹ç›®å¯ä»¥é€šè¿‡ `https://<username/orgname>.github.io/<project>/` è®¿é—®åˆ°ï¼›
- ä¸ªäººå¯ä»¥é€šè¿‡ `https://<username>.github.io/` è®¿é—®åˆ°ï¼›
- ç»„ç»‡å¯ä»¥é€šè¿‡ `https://<orgname>.github.io/` è®¿é—®åˆ°ã€‚

Hexo çš„æ’ä»¶ç”Ÿæ€æ¯”è¾ƒå…¨ï¼Œå…¶ä¸­çš„ hexo-deploy-git å¯ä»¥è¾…åŠ©æˆ‘ä»¬ä¸€é”®éƒ¨ç½²åˆ° GitHubã€‚ä¸‹é¢ä»¥ã€Œé¡¹ç›®éƒ¨ç½²æ–¹å¼ã€ä¸ºä¾‹ï¼Œå°†ç«™ç‚¹éƒ¨ç½²åˆ° `https://<username>.github.io/<repo>`ã€‚

1ï¼‰å®‰è£… Hexo éƒ¨ç½²åŒ… `hexo-deployer-git`ï¼š

```bash
npm install hexo-deployer-git --save  # --save æ˜¯ä¸ºäº†å†™å…¥åº“ä¾èµ–è¡¨ package.json
```

2ï¼‰åˆ›å»ºä¸€ä¸ª GitHub ä»“åº“å¹¶å°†æœ¬åœ°é¡¹ç›®æ¨é€åˆ° GitHubï¼š

```bash
git add .
git commit -m 'init'
git remote add origin https://github.com/Explorer-Dong/demo.git
git push -u origin main
```

*æ³¨ï¼šå¦‚æœæƒ³è¦ä»¥ä¸ªäººæˆ–ç»„ç»‡çš„å½¢å¼å»ºç«™ï¼Œå°±å°†ä»“åº“åå–ä¸º `<username/orgname>.github.io`ï¼Œå¦åˆ™éšæ„ã€‚

3ï¼‰é…ç½® `_config.yml` æ–‡ä»¶ï¼ˆå‡è®¾ä»“åº“åä¸º demo å¹¶ä¸”å°†ç½‘ç«™æ‰˜ç®¡åœ¨æ¨é€åˆ°ä»“åº“çš„ `public` åˆ†æ”¯ä¸‹ï¼‰ï¼š

```yaml
# ç½‘ç«™åœ°å€
url: https://explorer-dong.github.io/demo

# éƒ¨ç½²ç­–ç•¥
deploy:
  - type: git
    repo: https://github.com/Explorer-Dong/demo.git
    branch: public
```

4ï¼‰éƒ¨ç½²ï¼ˆå…¶å®å°±æ˜¯æŠŠç”Ÿæˆçš„ç½‘é¡µ push åˆ°ä¸Šè¿°éƒ¨ç½²ç­–ç•¥çš„ä»“åº“åˆ†æ”¯ä¸­ï¼‰ï¼š

```bash
hexo deploy  # å¯ç®€å†™ä¸º hexo d
```

5ï¼‰é…ç½® GitHub Pagesã€‚é€‰æ‹© Source ä¸º Deploy from a branch å¹¶é€‰ç”¨ `public` åˆ†æ”¯ï¼š

![é…ç½® GitHub Pages é¡µé¢](https://cdn.dwj601.cn/images/202501220201709.png)

ç°åœ¨è®¿é—® `https://<username>.github.io/demo/`ï¼Œå¦‚æœå¯ä»¥çœ‹åˆ°ä¸ä¹‹å‰æœ¬åœ°è°ƒè¯•æ—¶ä¸€æ ·çš„ç•Œé¢ï¼Œæ­å–œä½ ï¼Œç°åœ¨å·²ç»å¯ä»¥åœ¨é¡¹ç›®çš„ `source/_post/` ç›®å½•ä¸‹æ’°å†™æ–‡ç« å¹¶ä¸”å…¨çƒå…±äº«äº†ï¼

### åŸºäº GitHub Actions å·¥ä½œæµ

è¯¥æ–¹æ³•å¯ä»¥åˆ©ç”¨ GitHub Actions çš„ CI/CD åŠŸèƒ½ï¼Œè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆã€Œæœ¬åœ°æ„å»ºå¹¶éƒ¨ç½²ã€è¿™ä¸¤éƒ¨æ“ä½œï¼Œä»è€Œè®©æˆ‘ä»¬åªéœ€è¦åƒç»´æŠ¤é¡¹ç›®ä»£ç ä¸€æ ·ä¸“æ³¨äºå†…å®¹åˆ›ä½œä¸ç‰ˆæœ¬ç®¡ç†ï¼Œè€Œæ— éœ€å…³å¿ƒå…¶ä»–äº‹æƒ…ã€‚ä¸‹é¢ä»¥ã€Œæºç å’Œç«™ç‚¹åŒå±ä¸€ä¸ªä»“åº“ã€çš„åœºæ™¯ä¸ºä¾‹è®²è§£å¦‚ä½•é…ç½®ã€‚

1ï¼‰åˆ›å»ºä¸€ä¸ªç©º GitHub ä»“åº“å’Œä¸€ä¸ªé‰´æƒ tokenï¼ˆè¯¥é‰´æƒ token å¯ä»¥è®© GitHub Actions ä»¥ä½ çš„èº«ä»½æ“ä½œä½ çš„ä»“åº“ï¼‰ï¼š

![åˆ›å»ºä¸€ä¸ªé‰´æƒ tokenï¼šå¤´åƒ >> Settings >> Developer settings >> Personal access tokens >> Tokens (classic)](https://cdn.dwj601.cn/images/202501230044185.png)

2ï¼‰èµ‹äºˆ GitHub Actions è¯»å†™æƒé™ï¼š

![èµ‹äºˆ GitHub Actions è¯»å†™æƒé™ï¼šSettings >> Actions >> General >> Workflow permissions](https://cdn.dwj601.cn/images/202501230055064.png)

3ï¼‰æœ¬åœ°åˆå§‹åŒ–ä¸€ä¸ªåšå®¢é¡¹ç›®ï¼š

```bash
hexo init
```

4ï¼‰ç¼–è¾‘ `_config.yml` æ–‡ä»¶ä¸­çš„ `url` å­—æ®µï¼š

```yaml
url: https://explorer-dong.github.io/demo-github-actions
```

5ï¼‰åˆ›å»ºå·¥ä½œæµæ–‡ä»¶ .`github/workflows/bot.yml` å¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

```yaml
name: Build and Deploy
on: [push]
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # ç›¸å½“äº git clone åˆ°æœåŠ¡å™¨
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      # å®‰è£…ä¾èµ–å¹¶ç”Ÿæˆé¡µé¢
      - name: Install and Build ğŸ”§
        run: |
          npm install -g hexo-cli --save
          npm install
          hexo generate

      # éƒ¨ç½²
      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: gh-pages   # å­˜å‚¨ç«™ç‚¹çš„åˆ†æ”¯
          folder: public     # æ„å»ºå‡ºæ¥çš„å¾…éƒ¨ç½²çš„ç«™ç‚¹æ–‡ä»¶å¤¹åç§°
```

6ï¼‰åˆå§‹åŒ– Git ç‰ˆæœ¬ç®¡ç†å¹¶è¿æ¥åˆ°è¿œç¨‹ä»“åº“ï¼š

```bash
# åˆå§‹åŒ–
git init
git add .
git commit -m 'init'

# è¿æ¥è¿œç¨‹ä»“åº“
git remote add origin https://github.com/<user_name>/<repo_name>.git

# é¦–æ¬¡æ¨é€
git push -u origin main
```

7ï¼‰åœ¨ GitHub Pages ä¸Šé…ç½®ç«™ç‚¹æ‰˜ç®¡åˆ†æ”¯ï¼š

![åœ¨ GitHub Pages ä¸Šé…ç½®ç«™ç‚¹æ‰˜ç®¡åˆ†æ”¯ï¼šSettings >> Pages >> Build and deployment](https://cdn.dwj601.cn/images/202501230103361.png)

GitHub Pages æŒ‰ç…§ä¸Šè¿°å·¥ä½œæµçš„æŒ‡ä»¤ï¼Œæ£€æµ‹åˆ° push åå¼€å§‹æ‰§è¡Œï¼Œå³ checkoutã€generate å’Œ deployã€‚ç­‰å¾…æ‰€æœ‰æµç¨‹ç»“æŸåï¼Œé‡æ–°åŠ è½½ `https://<username>.github.io/<project>/` å°±å¯ä»¥å‘ç°ç«™ç‚¹å·²ç»æ‰˜ç®¡æˆåŠŸäº†ï¼

### åŸºäº Git Hooks

ç”±äº GitHub Pages æœåŠ¡ä½¿ç”¨çš„æœåŠ¡å™¨åœ¨ç¾å›½ï¼Œä¸ç”¨é­”æ³•è®¿é—®é€Ÿåº¦è¿‡æ…¢ï¼Œå›½å†…å¹³æ›¿ Gitee Pages å·²ç»åœæ­¢æœåŠ¡äº†ï¼Œç»¼åˆè€ƒè™‘è¿˜æ˜¯éƒ¨ç½²åˆ°å¤§é™†çš„æœåŠ¡å™¨ä¸Šã€‚å½“ç„¶è¿™å‰ææ˜¯ä½ å·²ç»æ‹¥æœ‰ä¸€å°å¤§é™†ã€Œå¤‡æ¡ˆã€çš„ [äº‘æœåŠ¡å™¨](https://www.aliyun.com/product/ecs?userCode=jpec1z57) å’Œä¸€ä¸ª [åŸŸå](https://wanwang.aliyun.com/domain/)ã€‚å¦‚æœè§‰å¾—å¤‡æ¡ˆå¤ªéº»çƒ¦ï¼Œå¯ä»¥è€ƒè™‘å…¥æ‰‹ä¸€å°é¦™æ¸¯æœåŠ¡å™¨ã€‚

å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€å°äº‘æœåŠ¡å™¨ã€‚ä¸ºäº†ç®€åŒ–åç»­æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼Œéœ€è¦å»ºç«‹æœ¬åœ°æœºå’Œäº‘æœåŠ¡å™¨çš„ [SSH](./ssh.md) è¿æ¥ã€‚ä¸‹é¢å°†åŸºäº [Git Hooks](https://githooks.com/) å·¥å…·ï¼Œä»‹ç»å¦‚ä½•å°†è‡ªå·±çš„ Hexo é™æ€ç½‘ç«™éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šã€‚

1ï¼‰åŸŸåè§£æã€‚æˆ‘ä»¬éœ€è¦å°†åŸŸåæŒ‡å‘è‡ªå·±æœåŠ¡å™¨çš„ IPï¼Œä¸‹å›¾ä¸­è®°å½•å€¼å³ä½ çš„äº‘æœåŠ¡å™¨ IP åœ°å€ï¼š

![åŸŸåè§£æ](https://cdn.dwj601.cn/images/202404051247292.png)

2ï¼‰é…ç½®æœåŠ¡å™¨ã€‚root ç”¨æˆ·çš„æƒé™è¿‡å¤§ä¸å¤Ÿå®‰å…¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·å¹¶èµ‹äºˆä¸€å®šçš„æƒé™ï¼š

```bash
# åˆ›å»ºæ–°ç”¨æˆ·ã€‚åç§°ä»»å–ï¼Œå‡è®¾å°±å« git
useradd git

# ä¿®æ”¹æ–°ç”¨æˆ·å¯†ç ã€‚åç»­é‡‡ç”¨ SSH å…å¯†é€šä¿¡ï¼Œå› æ­¤è¿™ä¸ªå¯†ç æ— æ‰€è°“
passwd git

# ç¼–è¾‘ /etc/sudoers æ–‡ä»¶ï¼Œåœ¨ root ALL=(ALL:ALL) ALL åè¿½åŠ ä¸€å¥
git ALL=(ALL:ALL) ALL
```

ç„¶åå®‰è£…å¹¶é…ç½® [Nginx](../operation/nginx.md)ï¼Œç¡®ä¿å¤–ç½‘ä¹Ÿå¯ä»¥è®¿é—®æœåŠ¡å™¨ã€‚

3ï¼‰åˆ›å»º Git Hooksã€‚ä¸ GitHub Pages è‡ªåŠ¨éƒ¨ç½²çš„å·¥ä½œæµé€»è¾‘ç±»ä¼¼ï¼Œæˆ‘ä»¬å°†é™æ€æ–‡ä»¶æ¨é€åˆ°äº‘æœåŠ¡å™¨åï¼Œéœ€è¦è®©äº‘æœåŠ¡å™¨å¸®æˆ‘ä»¬æŒç»­éƒ¨ç½²ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ© Git Hooks çš„åŠŸèƒ½æ¥å®ç°ï¼š

```bash
# åˆ›å»ºä¸€ä¸ª git è£¸ä»“åº“
mkdir /home/repo/blog.git
cd /home/repo/blog.git
git init --bare

# åˆ›å»º hooks æ–‡ä»¶ç”¨æ¥ç›‘è§†ä»“åº“çŠ¶æ€
cd hooks
touch post-receive

# ç¼–è¾‘ hooks æ–‡ä»¶ï¼Œåœ¨ post-receive æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹
# --work-tree è¡¨ç¤ºç«™ç‚¹è·¯å¾„
# --git-dir   è¡¨ç¤ºä»“åº“è·¯å¾„
git --work-tree=/home/web/blog --git-dir=/home/repo/blog.git checkout -f

# ä¸º hooks æ–‡ä»¶æˆäºˆå¯æ‰§è¡Œæƒé™
chmod +x /home/repo/blog.git/hooks/post-receive

# å°†ä»“åº“ç›®å½•çš„æ‰€æœ‰æƒç§»äº¤ç»™ git ç”¨æˆ·
chown -R git:git /home/repo

# å°†ç«™ç‚¹ç›®å½•çš„æ‰€æœ‰æƒç§»äº¤ç»™ git ç”¨æˆ·
chown -R git:git /home/web/blog
```

4ï¼‰æœ¬åœ°éƒ¨ç½²é…ç½®ã€‚ç¼–è¾‘ `_config.yml` ä¸­çš„ `url` å’Œ `deploy` å­—æ®µï¼š

- `url` å­—æ®µä¿®æ”¹ä¸ºè‡ªå·±çš„åŸŸåï¼š

    ```yaml
    url: https://blog.dwj601.cn
    ```

- `deploy` å­—æ®µé…ç½®å¦‚ä¸‹ï¼š

    ```yaml
    deploy:
      - type: git
        repo: git@xxx.xxx.xxx.xxx:/home/repo/blog.git  # å‰ç¼€ä¸ºæœåŠ¡å™¨ IP
        branch: main
    ```

æœ€åæˆ‘ä»¬åœ¨æœ¬åœ°æ‰§è¡Œ `hexo clean && hexo generate && hexo deploy` å³å¯å®ç°ä¸€æ­¥éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ã€‚æ­¤æ—¶æ£€æŸ¥æœåŠ¡å™¨å¯¹åº”ç›®å½•ï¼ˆè¿™é‡Œæ˜¯ `home/web/blog/`ï¼‰åº”å½“èƒ½çœ‹åˆ°æ‰€æœ‰çš„ç½‘é¡µæ–‡ä»¶ã€‚æµè§ˆå™¨è¾“å…¥å¯¹åº”çš„åŸŸåä¹Ÿåº”å½“å¯ä»¥çœ‹åˆ°å…·ä½“çš„å†…å®¹ã€‚

Git Hooks çš„å·¥ä½œåŸç†ä¸ GitHub Workflow ç±»ä¼¼ï¼Œéƒ½å¯ä»¥åœ¨æˆ‘ä»¬åšå‡ºæŸäº›è¡Œä¸ºçš„å‰åè‡ªåŠ¨æ‰§è¡Œä¸€äº›æˆ‘ä»¬é¢„è®¾å®šçš„ä»»åŠ¡ã€‚æ­¤å¤„ä½¿ç”¨åˆ°çš„å°±æ˜¯ [post-receive](https://git-scm.com/docs/githooks#post-receive) ä»»åŠ¡ã€‚åŸæ–‡æ˜¯è¿™æ ·è§£é‡Šçš„ï¼š

> This hook is invoked by git-receive-pack when it reacts to `git push` and updates reference(s) in its repository. It executes on the remote repository once after all the refs have been updated.

å³å½“å…¶æ¥æ”¶åˆ° push ä»»åŠ¡å¹¶ä¸”å­˜å‚¨åº“çš„ç´¢å¼•è¢«æ›´æ–°åï¼Œè¯¥é’©å­å°±ä¼šæ‰§è¡Œå…¶ä¸­çš„å†…å®¹ã€‚æˆ‘ä»¬åˆ©ç”¨è¯¥åŠŸèƒ½ï¼Œåœ¨å°†æˆ‘ä»¬çš„ç«™ç‚¹ `hexo deploy` åˆ°æœåŠ¡å™¨åï¼Œhooks æ£€æµ‹åˆ° Git ç´¢å¼•æ›´æ–°äº†ï¼Œå°±æ‰§è¡Œ checkout å‘½ä»¤æ¨é€ä¸Šæ¥çš„ç«™ç‚¹ checkout åˆ°æŒ‡å®šçš„ç«™ç‚¹æ‰˜ç®¡ç›®å½•ä¸‹ï¼Œä»è€Œå®ç°äº†æŒç»­é›†æˆçš„åŠŸèƒ½ã€‚æˆ‘ç”»äº†ä¸ªå·¥ä½œæµç¨‹å›¾ï¼Œæ›´ç›´è§‚çš„å±•ç¤ºäº† Git Hooks åœ¨è¿™ä¸ªåœºæ™¯ä¸‹çš„è¿è¡Œé€»è¾‘ï¼š

![åŸºäº Git Hooks çš„éƒ¨ç½²é€»è¾‘](https://cdn.dwj601.cn/images/202404081614614.jpg)

### åŸºäºæœ€æœ´ç´ çš„æ–¹æ³•

åŒæ ·éœ€è¦å…ˆé…ç½®å¥½ [SSH](./ssh.md) å’Œ [Nginx](../operation/nginx.md)ã€‚æ¥ä¸‹æ¥å°±ä¸¤æ­¥ï¼š

1ï¼‰æ‰“åŒ…ç½‘ç«™ã€‚å°† Markdown æ–‡ä»¶è½¬åŒ–ä¸º HTML æ–‡ä»¶ï¼š

```bash
hexo generate  # å¯ç®€å†™ä¸º hexo g
```

æ­¤æ—¶ä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•å¤šäº†ä¸€ä¸ªåä¸º `public` çš„æ–‡ä»¶å¤¹ã€‚

2ï¼‰éƒ¨ç½²ç½‘ç«™ã€‚å°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„ `public` æ–‡ä»¶å¤¹ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼š

```bash
#!/bin/bash

# å…¨å±€å˜é‡
REMOTE_USER="git"
REMOTE_HOST="47.100.217.241"
REMOTE_DIR="/home/web"
LOCAL_SOURCE_DIR="public"
ARCHIVE_NAME="blog.tar.gz"
TARGET_DIR_NAME="blog"

# åœ¨æœ¬åœ°å°†ç½‘ç«™å‹ç¼©ä¸ºä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¾¿äºç½‘ç»œä¼ è¾“
tar -czf $ARCHIVE_NAME $LOCAL_SOURCE_DIR/

# å°†å‹ç¼©åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨
sftp ${REMOTE_USER}@${REMOTE_HOST} << EOF
put -r $ARCHIVE_NAME $REMOTE_DIR/
bye
EOF

# å°†æœ¬åœ°çš„å‹ç¼©åŒ…åˆ é™¤ï¼ˆå¯é€‰ï¼‰
rm $ARCHIVE_NAME

# åœ¨æœåŠ¡å™¨ä¸Šå°†å‹ç¼©åŒ…è§£å‹
ssh ${REMOTE_USER}@${REMOTE_HOST} << EOF
cd $REMOTE_DIR
rm -rf $TARGET_DIR_NAME/
mkdir $TARGET_DIR_NAME/
chown -R ${REMOTE_USER}:${REMOTE_USER} $TARGET_DIR_NAME/
tar -xzf $ARCHIVE_NAME -C $TARGET_DIR_NAME/ --strip-components=1
rm $ARCHIVE_NAME
exit
EOF
```

## åŠŸèƒ½å¢å¼º

å¯¹ Hexo ç”Ÿæˆçš„ç½‘ç«™åšè¿›ä¸€æ­¥ä¸ªæ€§åŒ–çš„åŠŸèƒ½å¢å¼ºå®šåˆ¶ï¼Œéƒ¨åˆ†å‚è€ƒ [è¿™ç¯‡åšå®¢](https://blog.csdn.net/yaorongke/article/details/119089190)ã€‚

### è‡ªå®šä¹‰åŸŸå

å¦‚æœå°†ç½‘ç«™æ‰˜ç®¡åœ¨ GitHub Pages ä¸Šå¹¶ä¸”è§‰å¾— `xxx.github.io` ä¸èƒ½å‡¸æ˜¾å‡ºä½ çš„å†…å®¹ï¼ŒGitHub Pages æä¾›äº†è‡ªå®šä¹‰åŸŸåçš„æœåŠ¡ï¼ˆå°†åŸŸåæŒ‡å‘ GitHub çš„æœåŠ¡å™¨æ˜¯ä¸éœ€è¦å¤‡æ¡ˆçš„ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼‰ã€‚ä¸‹é¢ä»¥é˜¿é‡Œäº‘çš„åŸŸåä¸ºä¾‹å±•å¼€ä»‹ç»ã€‚

1ï¼‰è¿›å…¥äº‘å¹³å°ï¼Œå°†è‡ªå·±è´­ä¹°çš„åŸŸåç»‘å®šåˆ° GitHub Pages å¯¹åº”çš„è·¯ç”±åœ°å€ï¼š

![è¿›å…¥åŸŸåæ§åˆ¶å°å¹¶ç‚¹å‡»è§£ææŒ‰é’®](https://cdn.dwj601.cn/images/202403101115508.png)

2ï¼‰å¡«å†™è¡¨å•ï¼Œæ³¨æ„æ­¤å¤„çš„è§£æè¯·æ±‚æ¥æºä¸€å®šè¦å¡«é»˜è®¤ï¼ä¸è¦é€‰æ‹©å¢ƒå¤–ï¼Œå¦åˆ™æ— æ³•è§£ææˆåŠŸï¼š

![å¡«å†™è¡¨å•](https://cdn.dwj601.cn/images/202403101120914.png)

ç”±äºæ­¤å¤„æˆ‘è§£æçš„æ˜¯é¡¶çº§åŸŸåï¼Œå¸Œæœ›é€šè¿‡ `www.example.cn` å’Œ `example.cn` åŒæ—¶è®¿é—®åˆ°åšå®¢ç«™ç‚¹ï¼Œå› æ­¤æ·»åŠ äº†ä¸¤æ¡è§£æè®°å½•ï¼š

![æ·»åŠ è§£æè®°å½•](https://cdn.dwj601.cn/images/202403101117553.png)

3ï¼‰åœ¨ GitHub Pages ç•Œé¢ç»‘å®šåˆšæ‰è´­ä¹°çš„åŸŸåã€‚

è¿›å…¥ä»“åº“çš„ `Setting >> Pages` é¡µé¢ï¼Œåœ¨ Custom domain ä¸­å¡«å…¥ `<domain>.xxx` åŸŸåå¹¶å‹¾é€‰å¼ºåˆ¶ https æœåŠ¡ï¼š

![åœ¨ Custom domain ä¸­å¡«å…¥åŸŸå](https://cdn.dwj601.cn/images/202403101124296.png)

ç­‰å¾…å‡ åˆ†é’Ÿ DNS è§£æå³å¯ä½¿ç”¨ `<domain>.xxx` æˆ– `www.<domain>.xxx` æˆ– `<username>.github.io` è®¿é—®è‡ªå·±çš„é™æ€ç½‘ç«™å•¦ï¼åœ¨ä½¿ç”¨äº† CNAME çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨ `<username>.github.io` è®¿é—®ç«™ç‚¹ï¼Œä¸€èˆ¬ä¼šåšé‡å®šå‘ï¼Œå³é‡å®šå‘ä¸ºä½ è‡ªå·±çš„åŸŸåã€‚

4ï¼‰æœ€åçš„è¡¥ä¸ã€‚æ“ä½œå®Œä¸Šè¿°ä¸¤æ­¥ä»¥åï¼ŒGitHub ä»“åº“ä¼šå¤šä¸€ä¸ª CNAME æ–‡ä»¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ä»“åº“å†…å¤šäº†ä¸€ä¸ª CNAME æ–‡ä»¶](https://cdn.dwj601.cn/images/202403101223383.png)

è¿™æ˜¯å› ä¸ºè‡ªå®šä¹‰åŸŸååï¼ŒGitHub Pages æœåŠ¡éœ€è¦çŸ¥é“å°†è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªåŸŸåä¸Šï¼Œè€Œè¿™éœ€è¦ä» CNAME æ–‡ä»¶ä¸­è·å–ä¿¡æ¯ã€‚é‚£ä¹ˆå¯¹åº”çš„ï¼Œæœ¬åœ°å°±ä¹Ÿéœ€è¦å¢è®¾è¯¥æ–‡ä»¶ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `source` æ–‡ä»¶å¤¹ä¸‹æ·»åŠ è¯¥ CNAME æ–‡ä»¶å³å¯ï¼š

![åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ source æ–‡ä»¶å¤¹ä¸‹æ·»åŠ è¯¥ CNAME æ–‡ä»¶](https://cdn.dwj601.cn/images/202403101140516.png)

è¿™æ ·è¯¥ CNAME æ–‡ä»¶å°±ä¼šè¢« Hexo è¯†åˆ«ä¸ºè‡ªå·±çš„å†…å®¹ï¼Œä»è€Œæ¯æ¬¡éƒ½å¯ä»¥éƒ¨ç½²åˆ°ç›¸åº”çš„åˆ†æ”¯ä¸Šäº†ã€‚

### æ›´æ¢ mermaid çš„ CDN æº

Hexo-Fuild ä¸»é¢˜ä½¿ç”¨çš„ mermaid ç‰ˆæœ¬è¾ƒä½ï¼Œå¯èƒ½ä¼šå‡ºç°æœ¬åœ° Markdown ç¼–è¾‘å™¨æ¸²æŸ“æ­£å¸¸ï¼Œä½†è¿œç¨‹æœåŠ¡å™¨æ¸²æŸ“å¼‚å¸¸çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š

![ç½‘ç«™æ”¯æŒçš„ mermaid ç‰ˆæœ¬](https://cdn.dwj601.cn/images/202409120858955.png)

å¯ä»¥çœ‹åˆ°ç½‘ç«™è°ƒç”¨çš„ mermaid è„šæœ¬çš„ç‰ˆæœ¬æ˜¯ 8.14.0ã€‚æˆ‘ä»¬åœ¨æœ¬åœ° Markdown ç¼–è¾‘å™¨ï¼ˆè¿™é‡Œä»¥ Typora ä¸ºä¾‹ï¼‰è¾“å…¥ `info` åæŸ¥çœ‹æœ¬åœ° Markdown ç¼–è¾‘å™¨ä½¿ç”¨çš„ mermaid ç‰ˆæœ¬ï¼š

![æœ¬åœ° Typora æ”¯æŒçš„ mermaid ç‰ˆæœ¬](https://cdn.dwj601.cn/images/202409120854588.png)

æ˜¾ç„¶ç½‘ç«™ç”¨çš„ mermaid ç‰ˆæœ¬å¤ªä½äº†ã€‚è°ƒæ•´æ–¹æ³•å¾ˆç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹ç½‘ç«™è°ƒç”¨çš„ mermaid çš„è„šæœ¬é“¾æ¥å³å¯ã€‚å…·ä½“åœ°ï¼Œä¿®æ”¹ `_config_fluid.yml` ä¸­çš„ mermaid åŠ è½½åœ°å€ï¼š

![ä¿®æ”¹ hexo-fluid é…ç½®çš„ mermaid CDN æº](https://cdn.dwj601.cn/images/202409120902191.png)

*æ³¨ï¼šå®˜ç½‘ç»™å‡ºçš„ [é“¾æ¥](https://www.jsdelivr.com/package/npm/mermaid?version=10.9.1) æ— æ³•åœ¨ Hexo-Fluid ä¸»é¢˜ä¸­æ­£å¸¸æ¸²æŸ“ï¼Œå› ä¸ºå¤šäº†ä¸€ä¸ªæ–‡ä»¶å `mermaid.min.js`ï¼Œè€Œ Fluid ä¼šåœ¨é…ç½®çš„ CDN è·¯ç”±ä¸‹éå† `.js` æ–‡ä»¶ï¼Œå› æ­¤ç›´æ¥åˆ é™¤æ–‡ä»¶åå³å¯ã€‚

### å¢å¼ºæœç´¢åŠŸèƒ½

åœ¨ç½‘ç«™å¸¦å®½æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ 3 Mbpsï¼‰åŠ è½½çº¦ 8.5 MB çš„ `local-search.xml` æ–‡ä»¶éœ€è¦çº¦ $\frac{8.5\times 8}{3}\approx 23$ ç§’ï¼Œå¯ä»¥è€ƒè™‘å°†è¯¥ç´¢å¼•æ–‡ä»¶æ”¾åˆ° [OSS](https://www.aliyun.com/product/oss?userCode=jpec1z57) ä¸Šã€‚æ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š

1ï¼‰é…ç½® `_config.fluid.yml`ï¼š

ä» Fluid çš„é…ç½®æ–‡ä»¶ `_config.fluid.yml` ä¸­å¾ˆå®¹æ˜“æ‰¾åˆ° `search.path` å­—æ®µï¼Œå…¶æ˜ç¡®è¯´æ˜å¯ä»¥å°†ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„é…ç½®ä¸ºå¤–é“¾åœ°å€ï¼Œé‚£ä¹ˆç›´æ¥å°† `hexo generate` å‡ºæ¥çš„ `local-search.xml` æ–‡ä»¶ä¸¢åˆ° OSS ä¸­ï¼Œç„¶åé“¾æ¥åˆ°å¯¹åº”çš„ã€Œå…¬å…±è¯»ã€æ–‡ä»¶å³å¯ã€‚

*æ³¨ï¼šè¿™ä¹ˆåšçš„å‰ææ˜¯ [OSS çš„æµå‡ºå¸¦å®½](https://help.aliyun.com/zh/oss/product-overview/limits) è¦æ¯” 3 Mbps å¤§ï¼Œäº‹å®çš„ç¡®å¦‚æ­¤ã€‚

2ï¼‰OSS å®æ—¶æ›´æ–° `local-search.xml`ï¼š

ç”±äºæˆ‘ä¼šé¢‘ç¹æ›´æ–°ç¬”è®°å†…å®¹ï¼Œå°±éœ€è¦ç¡®ä¿ç´¢å¼•æ–‡ä»¶ä¹Ÿæ˜¯åŒæ­¥æ›´æ–°çš„ã€‚é‚£æ¯æ¬¡éƒ½è¦æ‰“å¼€é˜¿é‡Œäº‘ OSS æ§åˆ¶å°ç„¶åä¸Šä¼  `local-search.xml` æ–‡ä»¶å—ï¼Ÿå¿…ç„¶ä¸å¯èƒ½ã€‚é˜¿é‡Œäº‘ OSS æä¾›äº†è¯¸å¤šçš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä¾‹å¦‚ GUI å·¥å…·ï¼šoss browserã€CLI å·¥å…·ï¼šossutilã€å„ç§è¯­è¨€çš„ SDK ç­‰ï¼Œè¿™é‡Œç”¨ CLI å³å¯ã€‚è€ƒè™‘åˆ°éƒ¨ç½²é€»è¾‘é€æ¸å¤æ‚ï¼Œå¯ä»¥å†™ä¸€ä¸ª shell è„šæœ¬ï¼š

```bash
# å¤‡ä»½ç¬”è®°åˆ° GitHub
git push
# éƒ¨ç½²ç½‘ç«™
hexo clean && hexo generate && hexo deploy
# æ›´æ–° OSS ä¸Šçš„æœç´¢æ–‡ä»¶
ossutil cp /path/to/local-search.xml oss://<bucket_name>/path/to/oss_folder/
```

3ï¼‰è§£å†³ `OSS.Bucket` çš„è·¨åŸŸé—®é¢˜ï¼š

ç”±äº Hexo-Fuild çš„æœç´¢é€»è¾‘ä»£ç ç”¨åˆ°äº† Ajax è¯·æ±‚ï¼Œå¯¹äºäº‘æœåŠ¡å™¨ï¼Œå…¶éœ€è¦å‘ OSS å¯¹åº”çš„ä¸»æœºå‘èµ·è¯·æ±‚ï¼Œè¿™å°±ä¼šå¼•å‘æµè§ˆå™¨çš„ [è·¨åŸŸé—®é¢˜](https://zh.wikipedia.org/zh-cn/è·¨ä¾†æºè³‡æºå…±äº«) ä»è€Œå¯¼è‡´ `local-search.xml` æ–‡ä»¶æ— æ³•æ­£å¸¸è¢«åŠ è½½åˆ°ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚å»é˜¿é‡Œäº‘ OSS çš„æ§åˆ¶å°é…ç½®å¯¹åº” Bucket çš„ [è·¨åŸŸè§„åˆ™](https://help.aliyun.com/zh/oss/user-guide/cors-12/) å³å¯ã€‚ä¾‹å¦‚æˆ‘çš„é…ç½®ï¼š

![é…ç½®å¯¹åº” Bucket çš„è·¨åŸŸè§„åˆ™](https://cdn.dwj601.cn/images/202501192333282.png)

ç°åœ¨ 8.5 MB çš„ `local-search.xml` åªéœ€è¦å‡ ç™¾æ¯«ç§’å³å¯åŠ è½½å®Œæˆï¼Œå®Œç¾ï¼
